<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../components/tutorial-code-practice.html">
<link rel="import" href="../../components/tutorial-level-title.html">
<link rel="import" href="../../components/tutorial-paul.html">
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

<dom-module id="level-one-rock-polymer-dom-module">
    <template>
        <style>
            :host {
                display: block;
                font-family: Roboto;
                color: #fff;
                padding-left: 5%;
                padding-right: 5%;
                padding-bottom: 5%;
            }
        </style>

        <div class="container">
            <tutorial-level-title
                    value="Polymer Rocks"
                    level="1"
                    progress="[[_progress]]">
            </tutorial-level-title>

            <tutorial-paul text="[[_levelDescription]]"></tutorial-paul>

            <!--TODO shouldnt the follow up message be said by Paul?-->
            <template is="dom-if" if="{{_displayCode}}">
                <tutorial-code-practice tabs="[[_codeExercises]]"
                                        follow-up-message="[[_followUpMessage]]"></tutorial-code-practice>

                <tutorial-next-button visible="[[_codeIsCorrect]]" next="/1-6/">
                </tutorial-next-button>
            </template>
        </div>
    </template>

    <script>
        class LevelOneRockPolymerDomModule extends Polymer.Element {
            static get is() {
                return 'level-one-rock-polymer-dom-module';
            }

            static get properties() {
                return {
                    _levelDescription: {
                        type: Array,
                        value: ['Sometimes web components have html. But to add html to your rock, you need to let the browser know that the html belongs to your component.',
                        'To do this, you need a dom-module element. This element requires an id (your identification string). It should be added above your script tags and below your html import.',
                        'Add <dom-module id="your-id"> where your id is your identification string. And don\'t forget your closing tag!'],
                    },
                    _progress: {
                        type: Object,
                        value: {current: 5, total: 7}
                    },
                    _codeExercises: {
                        type: Array,
                        value: [],
                    },
                    _displayCode: {
                        type: Boolean,
                        value: false,
                    },
                    _followUpMessage: {
                        type: String,
                        value: 'Almost there! Your rock is almost ready for use. Let\'s find out what\'s missing.',
                    },
                    _codeIsCorrect: {
                        type: Boolean,
                        value: false,
                    }
                };
            }

            ready() {
                super.ready();
                this._initializeCodeExercises();

                this.addEventListener('paul-talked', this._showCode);
                this.addEventListener('solution-correct', () => this._showNextLevelButton(true));
                this.addEventListener('solution-incorrect', () => this._showNextLevelButton(false));
            }

            _initializeCodeExercises() {
                this._codeExercises = [
                    {
                        fileName: 'rock.html',
                        solutionRegExp: `(<link)(\\s)(rel="import")(\\s)(href="lib\/polymer\/polymer-element.html">)(\\s)+(<dom-module)(\\s)(id="rock">)(\\s)*(<\/dom-module>)(\\s)+(<script>)(\\s)+(class)(\\s)(Rock)(\\s)(extends)(\\s)(Polymer\\.Element)(\\s)+{(\\s)+(static get is\\(\\))(\\s)+{(\\s)+(return)(\\s)('rock'|"rock");(\\s)+}(\\s)+}(\\s)+(<\/script>)`,
                        template: `<link rel="import" href="lib/polymer/polymer-element.html">

<script>
    class Rock extends Polymer.Element {

        static get is() {
            return 'rock';
        }
    }
<\/script>`,
                        hint: `<link rel="import" href="lib/polymer/polymer-element.html">

<!-- <dom-module id="rock"> -->

<!-- </dom-module> -->

<script>
    class Rock extends Polymer.Element {

        static get is() {
            return 'rock';
        }
    }
<\/script>`
                    }
                ]
            }

            _showCode() {
                this._displayCode = true;
            }

            _showNextLevelButton(value) {
                this._codeIsCorrect = value;
            }
        }

        window.customElements.define(LevelOneRockPolymerDomModule.is, LevelOneRockPolymerDomModule);
    </script>
</dom-module>
