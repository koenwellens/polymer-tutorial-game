<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../components/tutorial-code-practice.html">
<link rel="import" href="../../components/tutorial-level-title.html">
<link rel="import" href="../../components/tutorial-paul.html">
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

<dom-module id="level-one-rock-polymer-import">
    <template>
        <style>
            :host {
                display: block;
                font-family: Roboto;
                color: #fff;
                padding-left: 5%;
                padding-right: 5%;
                padding-bottom: 5%;
            }

            .next {
                background-color: #e37222;
                color: #fff;
                margin-top: 5%;
                padding: 12px;
                font-size: 2em;
                border: 1px solid #e37222;
                width: 25%;
                border-radius: 25px;
                text-decoration: none;

                /* #07889B */
                /* #E37222 */
            }
        </style>

        <div class="container">
            <tutorial-level-title
                    value="Polymer Rocks"
                    level="1"
                    progress="[[_progress]]">
            </tutorial-level-title>

            <tutorial-paul text="[[_levelDescription]]"></tutorial-paul>

            <!--TODO shouldnt the follow up message be said by Paul?-->
            <template is="dom-if" if="{{_displayCode}}">
                <tutorial-code-practice tabs="[[_codeExercises]]"
                                        follow-up-message="[[_followUpMessage]]"></tutorial-code-practice>

                <!--TODO componentize the button?-->
                <template is="dom-if" if="{{_codeIsCorrect}}">
                    <a class="next" is="pushstate-anchor" href="/1-5/">Continue</a>
                </template>
            </template>
        </div>
    </template>

    <script>
        class LevelOneRockPolymerImport extends Polymer.Element {
            static get is() {
                return 'level-one-rock-polymer-import';
            }

            static get properties() {
                return {
                    _levelDescription: {
                        type: Array,
                        value: ['Almost there... This won\'t work as your browser doesn\'t know Polymer.Element.',
                        'You need to tell your browser where to find it. To do this, we\'ll use html imports.',
                        'A html import can be done as follows: <link rel="import" href="location">, where location is the location of the polymer-element.html file.',
                        'Add <link rel="import" href="location"> above your script tag. The location of polymer is "lib/polymer/polymer-element.html".'],
                    },
                    _progress: {
                        type: Object,
                        value: {current: 4, total: 7}
                    },
                    _codeExercises: {
                        type: Array,
                        value: [],
                    },
                    _displayCode: {
                        type: Boolean,
                        value: false,
                    },
                    _followUpMessage: {
                        type: String,
                        value: 'Wow! You created your first Polymer element. Let\'s make it look a bit nicer now and add content!',
                    },
                    _codeIsCorrect: {
                        type: Boolean,
                        value: false,
                    }
                };
            }

            ready() {
                super.ready();
                this._initializeCodeExercises();

                this.addEventListener('paul-talked', this._showCode);
                this.addEventListener('solution-correct', () => this._showNextLevelButton(true));
                this.addEventListener('solution-incorrect', () => this._showNextLevelButton(false));
            }

            _initializeCodeExercises() {
                this._codeExercises = [
                    {
                        fileName: 'rock.html',
                        solutionRegExp: `(<link)(\\s)(rel="import")(\\s)(href="lib\/polymer\/polymer-element.html">)(\\s)+(<script>)(\\s)+(class)(\\s)(Rock)(\\s)(extends)(\\s)(Polymer\\.Element)(\\s)+{(\\s)+(static get is\\(\\))(\\s)+{(\\s)+(return)(\\s)('rock'|"rock");(\\s)+}(\\s)+}(\\s)+(<\/script>)`,
                        template: `<script>
    class Rock extends Polymer.Element {

        static get is() {
            return 'rock';
        }
    }
<\/script>`,
                        hint: `<!-- <link rel="import" href="lib/polymer/polymer-element.html"> -->

<script>
    class Rock extends Polymer.Element {

        static get is() {
            return 'rock';
        }
    }
<\/script>`
                    }
                ]
            }

            _showCode() {
                this._displayCode = true;
            }

            _showNextLevelButton(value) {
                this._codeIsCorrect = value;
            }
        }

        window.customElements.define(LevelOneRockPolymerImport.is, LevelOneRockPolymerImport);
    </script>
</dom-module>
