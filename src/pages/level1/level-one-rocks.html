<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../../bower_components/monaco-editor/monaco-editor.html">
<link rel="import" href="../../components/tutorial-level-title.html">
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

<dom-module id="level-one-rocks">
    <template>
        <style>
            :host {
                display: block;
                font-family: Roboto;
                color: #fff;
                padding-left: 5%;
                padding-right: 5%;
                padding-bottom: 5%;
            }

            .disabled-next {
                background-color: lightgrey;
                color: #fff;
                margin-top: 5%;
                padding: 12px;
                font-size: 4em;
                border: 1px solid lightgrey;
                width: 25%;
                border-radius: 25px;
                text-decoration: none;
                pointer-events: none;
            }

            .next {
                background-color: #e37222;
                color: #fff;
                margin-top: 5%;
                padding: 12px;
                font-size: 4em;
                border: 1px solid #e37222;
                width: 25%;
                border-radius: 25px;
                text-decoration: none;

                /* #07889B */
                /* #E37222 */
            }

            .text1 {
                width: 80%;
                font-size: 1.2em;
            }

            p {
                line-height: 2;
            }

            .exercise-header {
                display: flex;
            }

            .tab {
                padding: 1%;
                font-size: 1.2em;
            }

            .exercise-body {
                margin-bottom: 5%;
                width: 100%;
            }

            .editor {
                width: 100%;
            }
        </style>

        <div class="container">
            <tutorial-level-title
                    value="Rock, Paper, ... Axes"
                    level="1"
                    progress="[[progress]]">
            </tutorial-level-title>

            <tutorial-paul text="[[levelDescription]]"></tutorial-paul>

            <template is="dom-if" if="{{displayRest}}">
                <div>
                    <div class="exercise-header">
                        <button id="tab-1" class="tab">
                            rock.html
                        </button>
                    </div>
                    <div class="exercise-body">
                        <monaco-editor class="editor" language="html" value="{{code}}">
                        </monaco-editor>
                    </div>
                </div>

                <div>
                    <template is="dom-if" if="{{!disabled}}">
                        <a class="next" is="pushstate-anchor" href="/soon/">Good job!</a>
                    </template>
                    <template is="dom-if" if="{{disabled}}">
                        <a class="disabled-next">Almost there...</a>
                    </template>
                </div>
            </template>
        </div>
    </template>

    <script>
        class LevelOneRocks extends Polymer.Element {
            static get is() {
                return 'level-one-rocks';
            }

            static get properties() {
                return {
                    disabled: {
                        type: Boolean,
                        value: true,
                    },
                    levelDescription: {
                        type: Array,
                        value: ['First, we\'ll need to collect some rocks. To do this, you\'ll need to create web components ' +
                        'that we can use further on in the quest. Your rock will be a JavaScript class. Good luck!'],
                    },
                    code: {
                        type: String,
                        value: `<script>
    // TODO
<\/script>`,
                        notify: true,
                        observer: '_codeChanged'
                    },
                    progress: {
                        type: Object,
                        value: {current: 1, total: 3}
                    },
                    displayRest: {
                        type: Boolean,
                        value: false,
                    }
                };
            }

            ready() {
                super.ready();
                this.addEventListener('paul-talked', e => this._displayNextLevelButton(e));
            }

            _displayNextLevelButton(e) {
                console.log(e);
                this.displayRest = true;
            }

            _codeChanged(newValue) {
                const correctCode = RegExp(`(<script>)(\\s)+(class)(\\s)(Rock)(\\s)+{(\\s)+}(\\s)+(<\/script>)`, 'gm');

                this.disabled = !correctCode.test(newValue);
            }
        }

        window.customElements.define(LevelOneRocks.is, LevelOneRocks);
    </script>
</dom-module>
